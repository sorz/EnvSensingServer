{% extends "measures/base.html" %}
{% block title %}EnvSensing{% endblock %}
{% block head %}
  {{ super() }}
  <style>
    #map { height: 500px; }
  </style>
{% endblock %}

{% block data %}
  <div id="map"></div>
{% endblock %}

{% block foot %}
{{ super() }}
<script>
  var map;
  var markers = [];

  function initMap() {
    map = new google.maps.Map($('#map')[0], {
      center: {lat: 22.18, lng: 113.55}, zoom: 12
    });
    readyToGetDataset();
  }

  function clearMarkers() {
    for (var i = 0; i < markers.length; i++)
      markers[i].setMap(null);
  }

  onDatasetChanged(function(measures) {
    clearMarkers();

    markers = new Array(measures.length);
    for (var i=0; i<measures.length; i++) {
      markers[i] = new google.maps.Marker({
        position: { lat: measures[i].latitude, lng: measures[i].longitude },
        title: 'item #' + i
      });
      markers[i].setMap(map);
    }
  });
</script>
<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC_Ja3Oxmtdg05gKml206MOx8J0fE-8ndQ&callback=initMap">
</script>
{% endblock %}
